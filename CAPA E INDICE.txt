<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Auto Arremate¬Æ / Arremaq 3.0 - Capa e √çndices</title>

    <link rel="stylesheet" href="src/assets/css/design-tokens.css">
    <link rel="stylesheet" href="src/assets/css/base.css">
    <link rel="stylesheet" href="src/assets/css/components.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

</head>
<body>

    <div class="accessibility-controls">
        <button id="increaseFontBtn" class="accessibility-btn" aria-label="Aumentar tamanho da fonte" title="Aumentar Fonte">
            <i class="fas fa-search-plus"></i>
        </button>
        <button id="decreaseFontBtn" class="accessibility-btn" aria-label="Diminuir tamanho da fonte" title="Diminuir Fonte">
            <i class="fas fa-search-minus"></i>
        </button>
        <button id="readPageBtn" class="accessibility-btn" aria-label="Ler p√°gina em voz alta" title="Ler P√°gina">
            <i class="fas fa-volume-up"></i>
        </button>
    </div>

    <main id="main-portal-completo">
        <section id="capa-section" class="capa-section" data-aos="fade-in" data-aos-duration="1200">
            <div class="logos-container">
                <img src="https://www.autoarremate.com.br/wp-content/uploads/2022/09/logo-horizontal-padrao.svg" alt="Logotipo da Auto Arremate" class="playbook-logo" data-aos="zoom-in" data-aos-delay="200" onerror="this.onerror=null; this.src='https://placehold.co/192x54/ffffff/16B097?text=Auto+Arremate&font=manrope'; this.alt='Logotipo Auto Arremate Indispon√≠vel';">
                <img src="https://www.arremaq.com.br/wp-content/uploads/2021/01/Logotipo-Arremaqsuperbid.png" alt="Logotipo da Arremaq" class="playbook-logo" data-aos="zoom-in" data-aos-delay="300" onerror="this.onerror=null; this.src='https://placehold.co/192x54/ffffff/FF8C00?text=Arremaq&font=manrope'; this.alt='Logotipo Arremaq Indispon√≠vel';">
            </div>
            <h1 class="capa-title fun-title-effect" data-aos="fade-up" data-aos-delay="500">
                <span class="capa-title-line"><span class="emoji-original-color">üèéÔ∏è</span> TRILHA DE APRENDIZADO <span class="emoji-original-color">üí®</span></span>
                <span class="capa-title-line"><span class="emoji-original-color">‚ö°</span> SEU GUIA REL√ÇMPAGO <span class="emoji-original-color">üí°</span></span>
                <span class="capa-title-line"><span class="emoji-original-color">üéØ</span> PARA UMA PERFORMANCE CAMPE√É <span class="emoji-original-color">üèÅ</span></span>
                <span class="capa-title-line"><span class="emoji-original-color">üèÜ</span> NA <span class="text-aa-green-darker">AUTO ARREMATE</span> E <span class="text-arremaq-orange-darker">ARREMAQ</span> <span class="emoji-original-color">üèÖ</span></span>
            </h1>
            <p class="frase-destaque frase-destaque-verde fun-frase-effect" data-aos="fade-up" data-aos-delay="700">
                <span class="emoji">üöÄ</span> S√ì OS FORTES ACELERAM, MAS APENAS OS S√ÅBIOS DOMINAM A ARTE DE FREAR! <span class="emoji">üõë</span>
            </p>
            <p class="capa-criado" data-aos="fade-up" data-aos-delay="1000"> <span class="emoji">‚ú®</span> Criado pelo <span class="emoji">üë®‚Äçüíª</span> Analista de Opera√ß√µes - <strong class="creator-name">Marcelo do Nascimento</strong> <span class="emoji">üöÄ</span>
            </p>
            <button id="btnIniciarCapa" class="btn-iniciar" data-aos="fade-up" data-aos-delay="1100"> EMBARCAR NESSA CORRIDA √âPICA!
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width: 1.2em; height: 1.2em;"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            </button>
            <div class="capa-social-links" data-aos="fade-up" data-aos-delay="1200">
                <a href="https://facebook.com/auto-arremate" target="_blank" aria-label="Facebook Auto Arremate"><i class="fab fa-facebook-f"></i></a>
                <a href="https://www.autoarremate.com.br/podcast-dirigindo-vendas/" target="_blank" aria-label="Podcast Dirigindo Vendas" title="Podcast Dirigindo Vendas"><i class="fas fa-podcast"></i></a>
                <a href="https://www.instagram.com/autoarremate/" target="_blank" aria-label="Instagram Auto Arremate"><i class="fab fa-instagram"></i></a>
                <a href="https://www.linkedin.com/company/autoarremate/" target="_blank" aria-label="LinkedIn Auto Arremate"><i class="fab fa-linkedin-in"></i></a>
                <a href="https://wa.me/5511940366065" target="_blank" aria-label="WhatsApp Auto Arremate"><i class="fab fa-whatsapp"></i></a>
            </div>
        </section>

        <section id="menu-principal-section" class="menu-principal-section hidden" data-aos="fade-in">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="menu-principal-title" data-aos="fade-down">
                    <span class="emoji-original-color">üö¶</span> CENTRAL DE COMANDO <span class="text-aa-green-darker">AUTO ARREMATE</span> & <span class="text-arremaq-orange-darker">ARREMAQ</span> <span class="emoji-original-color">üõ†Ô∏è</span>
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 md:gap-10 mt-12 md:mt-16">
                    <div id="openManualPitStopBtn" class="menu-card" data-aos="fade-up" data-aos-delay="100">
                        <span class="menu-card-icon"><i class="fas fa-flag-checkered text-gray-600 dark:text-gray-400"></i></span>
                        <h3 class="menu-card-title">
                            <span class="emoji-original-color">üèÅ</span> ROTA DOS CAMPE√ïES <span class="emoji-original-color">üèÜ</span>
                        </h3>
                    </div>
                    <div id="openAcademiaRepassadoresBtn" class="menu-card" data-aos="fade-up" data-aos-delay="400">
                        <span class="menu-card-icon"><i class="fas fa-graduation-cap text-red-500 dark:text-red-400"></i></span>
                        <h3 class="menu-card-title">
                           <span class="emoji-original-color">‚õΩ</span> ACADEMIA DE REPASSADORES 3.0
                        </h3>
                    </div>
                    <div id="generateCertificateCard" class="menu-card disabled certificate-card" data-aos="fade-up" data-aos-delay="500">
                        <span class="menu-card-icon"><i class="fas fa-certificate text-yellow-500 dark:text-yellow-400"></i></span>
                        <h3 class="menu-card-title">
                           <span class="emoji-original-color">üèÖ</span> GERAR CERTIFICADO
                        </h3>
                        <p id="certificateProgress" class="text-sm text-gray-500 mt-4 dark:text-gray-400">
                            Complete todos os m√≥dulos da trilha para gerar seu certificado.
                        </p>
                    </div>
                </div>
                <button id="backToCoverBtnMenu" class="btn-nav-playbook btn-outline mt-16 mx-auto">
                    <i class="fas fa-arrow-left"></i> VOLTAR √Ä CAPA
                </button>
            </div>
        </section>

        <section id="manual-pitstop-detalhes-section" class="manual-pitstop-detalhes-section hidden" data-aos="fade-in">
            <div class="container mx-auto">
                    <button class="btn-nav-playbook btn-outline back-to-menu-principal mb-10 text-sm">
                    <i class="fas fa-arrow-left mr-2"></i> VOLTAR AO MENU PRINCIPAL
                </button>
                <h2 class="manual-pitstop-main-title">
                    <span class="emoji-original-color">üõ†Ô∏è</span> ROTA DOS CAMPE√ïES: SEUS M√ìDULOS DE ALTA PERFORMANCE <span class="emoji-original-color">üèÜ</span>
                </h2>
                <div id="playbookIndexContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 md:gap-8 py-8">
                    </div>
            </div>
        </section>

        <section id="placeholder-content-section" class="playbook-sub-section hidden">
             <div class="container mx-auto">
                <button class="btn-nav-playbook btn-outline back-to-manual-pitstop-detalhes mb-10 text-sm">
                    <i class="fas fa-arrow-left mr-2"></i> VOLTAR AOS M√ìDULOS
                </button>
                <h2 id="content-title-placeholder" class="text-2xl font-bold text-center my-8"></h2>
                <p id="content-paragraph-placeholder" class="text-lg text-center"></p>
             </div>
        </section>

    </main>

    <div id="userInfoModal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close-btn" role="button" aria-label="Fechar Modal">&times;</span>
            <h2 class="modal-title">‚ú® Preencha Seus Dados para Iniciar sua jornada de aprendizado ‚ú®</h2>
            <form id="userInfoForm" class="modal-form">
                <label for="fullName">Nome Completo:</label>
                <input type="text" id="fullName" name="fullName" placeholder="Seu nome completo" class="form-input-base" required aria-required="true">

                <label for="email">Email:</label>
                <input type="email" id="email" name="email" placeholder="seu.email@example.com" class="form-input-base" required aria-required="true">
                <p class="text-sm text-red-500 hidden" id="emailError">Por favor, insira um email v√°lido.</p>

                <label for="entryDate">Data de Entrada:</label>
                <input type="date" id="entryDate" name="entryDate" class="form-input-base" required aria-required="true">
                <p class="text-sm text-red-500 hidden" id="dateError">Por favor, insira uma data v√°lida.</p>

                <label for="position">Cargo:</label>
                <input type="text" id="position" name="position" placeholder="Seu cargo na empresa" class="form-input-base" required aria-required="true">

                <button type="submit" class="btn btn-primary" aria-label="Iniciar Trilha de Aprendizado">INICIAR TRILHA</button>
            </form>
        </div>
    </div>

    <div id="certificateModal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close-btn" role="button" aria-label="Fechar Certificado">&times;</span>
            <h2 class="certificate-header">PARAB√âNS, CAMPE√ÉO(√É)!</h2>
            <p class="certificate-subheader">VOC√ä CONCLUIU A TRILHA DE APRENDIZADO!</p>
            <div class="certificate-body">
                <p>Certificamos que <strong><span id="certFullName"></span></strong>, em reconhecimento √† sua dedica√ß√£o e conclus√£o bem-sucedida de todos os m√≥dulos da "Trilha de Aprendizado: Seu Guia Rel√¢mpago para uma Performance Campe√£", demonstrando profundo conhecimento e preparo em seu cargo de <strong><span id="certPosition"></span></strong>.</p>
                <p class="mt-4">Este certificado √© um testemunho do seu compromisso com a excel√™ncia e o aprimoramento cont√≠nuo em suas atividades na Auto Arremate e Arremaq.</p>
            </div>
            <p class="certificate-footer">Emitido em <span id="certIssueDate"></span>.</p>
            <button id="copyCertificateBtn" class="btn btn-primary">COPIAR CERTIFICADO</button>
        </div>
    </div>

    <button id="themeToggleBtn" class="theme-toggle-btn" aria-label="Alternar tema" title="Alternar Tema">
        <i class="fas fa-moon"></i>
    </button>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script type="module" defer>
        // Importar as fun√ß√µes dos arquivos JavaScript globais
        import { initializeAudio, playSound, localStorageManager } from './src/assets/js/utils.js';
        import { initializeThemeManager, applyTheme } from './src/assets/js/theme-manager.js';
        import { initializeAccessibilityControls, adjustFontSize, readPageContent } from './src/assets/js/accessibility-manager.js';
        import { showSection, initializeNavigation } from './src/assets/js/navigation-manager.js';

        // Vari√°vel para controlar se o modal de informa√ß√µes do usu√°rio j√° foi exibido e os dados preenchidos
        let userDataSubmitted = false;

        // --- Dados do √çndice da Trilha (Atualizados) ---
        const indexDataPlaybook = [
            { id: "MODULO_1_PISTA_DECOLAGEM", emoji: "üìú", title: "<strong>M√ìD1: NOSSA PISTA DE DECOLAGEM</strong>: HIST√ìRIA, VALORES E A FOR√áA DA EQUIPE AUTO ARREMATE & ARREMAQ!", sub: "Conhe√ßa o motor que impulsiona a Auto Arremate & Arremaq: nossa cultura, miss√£o e o time de campe√µes.", sentenceEmoji: "üìú" },
            { id: "MODULO_12_BOX_IDENTIDADE", emoji: "<span class='emoji-original-color'>üé®</span>", title: "<strong>M√ìD2: BOX DA IDENTIDADE AUTO ARREMATE</strong>: CONSTRUINDO SUA MARCA!", sub: "Entenda os pilares da identidade visual e comunica√ß√£o para fortalecer sua presen√ßa e impacto.", sentenceEmoji: "üé®" },
            { id: "MODULO_2_POLE_POSITION", emoji: "<span class='emoji-original-color'>üöó</span>", title: "<strong>M√ìD3: AUTO ARREMATE NA POLE POSITION</strong>: DOMINANDO O UNIVERSO DOS VE√çCULOS LEVES!", sub: "Descubra como nossa plataforma acelera a gest√£o e venda de ve√≠culos leves, da capta√ß√£o √† comercializa√ß√£o.", sentenceEmoji: "üèÜ" },
            { id: "MODULO_3_FORCA_BRUTA", emoji: "<span class='emoji-original-color'>üöú</span>", title: "<strong>M√ìD4: ARREMAQ</strong>: A FOR√áA BRUTA DOS GIGANTES DO AGRO E CONSTRU√á√ÉO!", sub: "Solu√ß√µes de peso e estrat√©gias robustas para o repasse eficiente de m√°quinas agr√≠colas e de constru√ß√£o.", sentenceEmoji: "‚öôÔ∏è" },
            { id: "MODULO_4_CAMPEOES", emoji: "üéØ", title: "<strong>M√ìD5: MAPEANDO OS CAMPE√ïES</strong>: NOSSOS CLIENTES IDEAIS AUTO ARREMATE & ARREMAQ (ICPS & PERSONAS)!", sub: "Identifique os perfis de clientes com maior potencial e as personas chave para uma abordagem estrat√©gica.", sentenceEmoji: "üåü" },
            { id: "MODULO_5_JORNADA_CLIENTE", emoji: "üìä", title: "<strong>M√ìD6: A JORNADA DO CLIENTE VENCEDOR AUTO ARREMATE & ARREMAQ</strong>: DA PROSPEC√á√ÉO √Ä BANDEIRADA FINAL (ANIMA√á√ÉO)!", sub: "Visualize a transforma√ß√£o do cliente, da necessidade √† solu√ß√£o, atrav√©s de nossa anima√ß√£o din√¢mica.", sentenceEmoji: "üé¨" },
            { id: "MODULO_6_ACELERACAO_TATICA", emoji: "üöÄ", title: "<strong>M√ìD7: ACELERA√á√ÉO T√ÅTICA TOTAL</strong>", sub: "Seu centro de comando para conectar, qualificar e converter. ‚ú® Todas as estrat√©gias, para todas as personas, em um s√≥ lugar.", sentenceEmoji: "‚ú®" },
            { id: "MODULO_7_COMUNICACAO", emoji: "‚úçÔ∏è", title: "<strong>M√ìD8: A ARTE DA COMUNICA√á√ÉO ESTRAT√âGICA AUTO ARREMATE & ARREMAQ</strong>: MODELOS QUE CONVERTEM!", sub: "Termos de impacto, orienta√ß√µes e exemplos pr√°ticos para uma comunica√ß√£o persuasiva e eficaz.", sentenceEmoji: "üó£Ô∏è" },
            { id: "MODULO_8_GLOSSARIO", emoji: "üìñ", title: "<strong>M√ìD9: DICION√ÅRIO DOS MESTRES</strong>: GLOSS√ÅRIO AUTO ARREMATE & ARREMAQ!", sub: "Decifre os termos t√©cnicos e jarg√µes do mercado automotivo e de m√°quinas para dominar a linguagem do setor.", sentenceEmoji: "üìö" },
            { id: "MODULO_9_EVOLUCAO_CONTINUA", emoji: "üìà", title: "<strong>M√ìD10: EVOLU√á√ÉO CONT√çNUA</strong>: NOSSA TRILHA DE APRENDIZADO AUTO ARREMATE & ARREMAQ EM CONSTANTE APERFEI√áOAMENTO!", sub: "Os pr√≥ximos passos para o desenvolvimento do playbook e o crescimento cont√≠nuo da nossa equipe.", sentenceEmoji: "üåå" },
            { id: "MODULO_10_CENTRAL_COMANDO", emoji: "üìû", title: "<strong>M√ìD11: CENTRAL DE COMANDO AUTO ARREMATE & ARREMAQ</strong>: CANAIS DE CONTATO E SUPORTE √ÅGIL!", sub: "Acesse nossos canais de suporte dedicados e encontre ajuda r√°pida para suas d√∫vidas e desafios.", sentenceEmoji: "üõ†Ô∏è" },
            { id: "MODULO_11_DESAFIO_CAMPEOES", emoji: "üèÜ", title: "<strong>M√ìD12: DESAFIO DOS CAMPE√ïES AUTO ARREMATE</strong>: TESTE SEU CONHECIMENTO ESTRAT√âGICO!", sub: "Teste sua sabedoria e ast√∫cia em nosso quiz gamificado sobre o playbook e o universo do repasse!", sentenceEmoji: "üèÖ" },
            { id: "MODULO_13_ACADEMIA_REPASSADORES", emoji: "üèéÔ∏èüí®", title: "<strong>M√ìD13: ACADEMIA DE REPASSADORES AUTO ARREMATE & ARREMAQ</strong>: TURBINE SEU TALENTO PARA A VIT√ìRIA!", sub: "Seu acesso de elite ao conhecimento e ferramentas para vendas automotivas de alta performance.", sentenceEmoji: "üèÅ" },
            { id: "CERTIFICADO", emoji: "üèÖ", title: "<strong>CERTIFICADO</strong>: IMPRIMA SEU P√ìDIO!", sub: "Gere e imprima seu certificado de conclus√£o da Trilha de Aprendizado.", sentenceEmoji: "üèÖ" } // Adicionado CERTIFICADO
        ];


        const playbookIndexContainer = document.getElementById('playbookIndexContainer');

        // Objeto para armazenar o progresso dos m√≥dulos
        let trilhaProgress = {};

        // Elementos do Modal de Informa√ß√µes do Usu√°rio
        const userInfoModal = document.getElementById('userInfoModal');
        const userInfoForm = document.getElementById('userInfoForm');
        const emailInput = document.getElementById('email');
        const entryDateInput = document.getElementById('entryDate');
        const emailError = document.getElementById('emailError');
        const dateError = document.getElementById('dateError');

        // Elementos do Modal de Certificado
        const certificateModal = document.getElementById('certificateModal');
        const certFullNameSpan = document.getElementById('certFullName');
        const certPositionSpan = document.getElementById('certPosition');
        const certIssueDateSpan = document.getElementById('certIssueDate');
        const copyCertificateBtn = document.getElementById('copyCertificateBtn');

        // Elementos do Card de Certificado no menu principal
        const generateCertificateCard = document.getElementById('generateCertificateCard');
        const certificateProgressText = document.getElementById('certificateProgress');

        document.addEventListener('DOMContentLoaded', function () {
            AOS.init({
                duration: 900,
                once: true,
                offset: 80,
                easing: 'ease-in-out'
            });

            // Inicializa gerenciadores globais
            initializeAudio(); // A fun√ß√£o j√° escuta por intera√ß√µes do usu√°rio
            initializeThemeManager('themeToggleBtn');
            initializeAccessibilityControls('increaseFontBtn', 'decreaseFontBtn', 'readPageBtn', 'main-portal-completo'); // Ajustado para main-portal-completo

            loadTrilhaProgress(); // Carrega o progresso ao iniciar
            checkCertificateEligibility(); // Verifica o estado do certificado ao iniciar

            // --- Listeners de Eventos de Navega√ß√£o e Sons ---
            document.getElementById('btnIniciarCapa').addEventListener('click', async (e) => {
                e.preventDefault();
                playSound('click');
                if (!userDataSubmitted) {
                    userInfoModal.classList.add('show');
                } else {
                    showSection('menu-principal-section');
                }
            });

            // Listener para o card "ACADEMIA DE REPASSADORES 3.0"
            document.getElementById('openAcademiaRepassadoresBtn').addEventListener('click', async (e) => {
                e.preventDefault();
                playSound('click');
                showSection('MODULO_13_ACADEMIA_REPASSADORES'); // Navega para a se√ß√£o da Academia
            });

            // Listener para o card "GERAR CERTIFICADO"
            if (generateCertificateCard) {
                generateCertificateCard.addEventListener('click', async () => {
                    if (!generateCertificateCard.classList.contains('disabled')) {
                        playSound('click');
                        showCertificate();
                    } else {
                        console.log("A trilha n√£o est√° completa. Certificado n√£o pode ser gerado.");
                    }
                });
            }

            // --- L√≥gica do Modal de Informa√ß√µes do Usu√°rio ---
            const modalCloseBtn = userInfoModal.querySelector('.modal-close-btn');
            if (modalCloseBtn) {
                modalCloseBtn.addEventListener('click', () => {
                    playSound('click');
                    userInfoModal.classList.remove('show');
                });
            }

            if (userInfoModal) {
                userInfoModal.addEventListener('click', (e) => {
                    if (e.target === userInfoModal) {
                        playSound('click');
                        userInfoModal.classList.remove('show');
                    }
                });
            }

            if (userInfoForm) {
                userInfoForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    playSound('click');

                    let isValid = true;
                    if (!document.getElementById('fullName').value.trim()) { isValid = false; }
                    if (!document.getElementById('position').value.trim()) { isValid = false; }
                    if (!emailInput.validity.valid) { emailError.classList.remove('hidden'); isValid = false; } else { emailError.classList.add('hidden'); }
                    if (!entryDateInput.validity.valid) { dateError.classList.remove('hidden'); isValid = false; } else { dateError.classList.add('hidden'); }

                    if (!isValid) {
                        console.log('Por favor, preencha todos os campos corretamente.');
                        return;
                    }

                    const userData = {
                        fullName: document.getElementById('fullName').value,
                        email: document.getElementById('email').value,
                        entryDate: document.getElementById('entryDate').value,
                        position: document.getElementById('position').value
                    };

                    try {
                        localStorageManager('trilhaUserData', userData); // Usa localStorageManager
                        userDataSubmitted = true;
                        userInfoModal.classList.remove('show');
                        showSection('menu-principal-section');
                        console.log('Dados do usu√°rio salvos:', userData);
                        checkCertificateEligibility();
                    } catch (error) {
                        console.error('Erro ao salvar dados do usu√°rio:', error);
                    }
                });
            }

            // Carrega dados do usu√°rio ao iniciar
            try {
                const storedUserData = localStorageManager('trilhaUserData'); // Usa localStorageManager
                if (storedUserData) {
                    userDataSubmitted = true;
                    document.getElementById('fullName').value = storedUserData.fullName || '';
                    document.getElementById('email').value = storedUserData.email || '';
                    document.getElementById('entryDate').value = storedUserData.entryDate || '';
                    document.getElementById('position').value = storedUserData.position || '';
                }
            } catch (error) {
                console.warn("LocalStorage n√£o dispon√≠vel ou dados corrompidos para informa√ß√µes do usu√°rio.");
            }

            // --- L√≥gica do Modal de Certificado ---
            const certificateModalCloseBtn = certificateModal.querySelector('.modal-close-btn');
            if (certificateModalCloseBtn) {
                certificateModalCloseBtn.addEventListener('click', () => {
                    playSound('click');
                    certificateModal.classList.remove('show');
                });
            }

            if (certificateModal) {
                certificateModal.addEventListener('click', (e) => {
                    if (e.target === certificateModal) {
                        playSound('click');
                        certificateModal.classList.remove('show');
                    }
                });
            }

            // No Capa e √çndice, o bot√£o de copiar certificado deve redirecionar para o m√≥dulo do certificado
            if (copyCertificateBtn) {
                copyCertificateBtn.addEventListener('click', async () => {
                    playSound('click');
                    showSection('CERTIFICADO'); // Leva para a p√°gina do certificado real
                    certificateModal.classList.remove('show'); // Fecha o modal
                });
            }


            /**
             * Renderiza os cards do √≠ndice da trilha no container.
             * Cada card representa um m√≥dulo e possui um listener para exibir seu conte√∫do.
             */
            function renderPlaybookIndex() {
                if (!playbookIndexContainer) return;
                playbookIndexContainer.innerHTML = '';

                indexDataPlaybook.forEach((item, index) => {
                    const card = document.createElement('div');
                    card.className = 'index-item-card card-base'; // Adiciona 'card-base' para estilos consistentes
                    card.setAttribute('data-aos', 'fade-up');
                    card.setAttribute('data-aos-delay', (index * 100).toString());

                    let emojiHtml = item.emoji.includes("<span") ? item.emoji : `<span class="emoji-original-color">${item.emoji}</span>`;

                    // Adiciona classe 'completed' se o m√≥dulo estiver completo
                    if (trilhaProgress[item.id]) {
                        card.classList.add('completed'); // Uma classe para estilizar m√≥dulos completos no CSS
                        card.innerHTML = `
                            <span class="index-item-emoji">${emojiHtml}</span>
                            <h3 class="index-item-title">${item.title}</h3>
                            <p class="index-item-sub">
                                ${item.sentenceEmoji ? `<span class="sentence-emoji emoji-original-color">${item.sentenceEmoji}</span>` : ''}
                                ${item.sub}
                            </p>
                            <span class="absolute top-4 right-4 text-aa-green-darker dark:text-aa-green-lighter text-2xl" aria-label="M√≥dulo Completo"><i class="fas fa-check-circle"></i></span>
                        `;
                    } else {
                        card.innerHTML = `
                            <span class="index-item-emoji">${emojiHtml}</span>
                            <h3 class="index-item-title">${item.title}</h3>
                            <p class="index-item-sub">
                                ${item.sentenceEmoji ? `<span class="sentence-emoji emoji-original-color">${item.sentenceEmoji}</span>` : ''}
                                ${item.sub}
                            </p>`;
                    }

                    // Adiciona listener de clique para exibir a se√ß√£o de conte√∫do do m√≥dulo e marcar como completo
                    card.addEventListener('click', async () => {
                        playSound('click');
                        // No futuro, aqui voc√™ faria o carregamento din√¢mico do conte√∫do do m√≥dulo ou
                        // exibiria a se√ß√£o espec√≠fica do m√≥dulo, se ela j√° estiver no DOM.
                        // Por agora, vamos usar o placeholder e marcar como completo.
                        markModuleAsComplete(item.id);

                        // Mapeia o ID do m√≥dulo para o ID da se√ß√£o HTML correspondente
                        const sectionMap = {
                            "MODULO_1_PISTA_DECOLAGEM": "pista-decolagem-section",
                            "MODULO_12_BOX_IDENTIDADE": "box-identidade-content-section",
                            "MODULO_2_POLE_POSITION": "playbook-sec-1-content-main",
                            "MODULO_3_FORCA_BRUTA": "playbook-sec-arremaq-content-main",
                            "MODULO_4_CAMPEOES": "playbook-sec-2-content-main",
                            "MODULO_5_JORNADA_CLIENTE": "jornada-cliente-aa-content-section",
                            "MODULO_6_ACELERACAO_TATICA": "content-area-aceleracao", // Esta √© a div principal do M√≥dulo 6
                            "MODULO_7_COMUNICACAO": "playbook-sec-7-content-main",
                            "MODULO_8_GLOSSARIO": "playbook-sec-8-content-main",
                            "MODULO_9_EVOLUCAO_CONTINUA": "playbook-sec-9-content-main",
                            "MODULO_10_CENTRAL_COMANDO": "playbook-sec-10-content-main",
                            "MODULO_11_DESAFIO_CAMPEOES": "playbook-sec-11-content-main",
                            "MODULO_13_ACADEMIA_REPASSADORES": "academia-repassadores-content-section",
                            "CERTIFICADO": "certificateContainer" // Mapeia para o ID do cont√™iner do certificado
                        };
                        const targetSectionId = sectionMap[item.id];
                        if (targetSectionId) {
                            showSection(targetSectionId); // Usa a fun√ß√£o showSection do navigation-manager
                        } else {
                            // Se o ID do m√≥dulo n√£o estiver mapeado para uma se√ß√£o espec√≠fica,
                            // usa o placeholder ou exibe uma mensagem de erro
                            document.getElementById('content-title-placeholder').innerHTML = item.title;
                            document.getElementById('content-paragraph-placeholder').innerText = "Conte√∫do para esta se√ß√£o est√° em desenvolvimento ou n√£o foi mapeado.";
                            showSection('placeholder-content-section');
                        }
                    });

                    playbookIndexContainer.appendChild(card);
                });
            }

            // --- Fun√ß√µes de L√≥gica do Certificado e Progresso da Trilha ---
            function loadTrilhaProgress() {
                try {
                    const storedProgress = localStorageManager('trilhaProgress');
                    if (storedProgress) {
                        trilhaProgress = storedProgress;
                    } else {
                        indexDataPlaybook.forEach(module => {
                            trilhaProgress[module.id] = false;
                        });
                        localStorageManager('trilhaProgress', trilhaProgress);
                    }
                } catch (error) {
                    console.warn("Erro ao carregar ou inicializar progresso da trilha:", error);
                    indexDataPlaybook.forEach(module => { trilhaProgress[module.id] = false; });
                    localStorageManager('trilhaProgress', trilhaProgress);
                }
            }

            function saveTrilhaProgress() {
                localStorageManager('trilhaProgress', trilhaProgress);
            }

            function markModuleAsComplete(moduleId) {
                if (trilhaProgress.hasOwnProperty(moduleId) && !trilhaProgress[moduleId]) {
                    trilhaProgress[moduleId] = true;
                    saveTrilhaProgress();
                    console.log(`M√≥dulo ${moduleId} marcado como completo.`);
                    checkCertificateEligibility();
                }
            }

            function checkCertificateEligibility() {
                const totalModules = indexDataPlaybook.length;
                const completedModules = Object.values(trilhaProgress).filter(status => status).length;
                const allModulesCompleted = completedModules === totalModules;

                if (generateCertificateCard) {
                    if (allModulesCompleted) {
                        generateCertificateCard.classList.remove('disabled');
                        generateCertificateCard.removeAttribute('aria-disabled');
                        generateCertificateCard.style.cursor = 'pointer';
                        certificateProgressText.textContent = 'Parab√©ns! Sua trilha est√° completa. Clique para gerar seu certificado!';
                    } else {
                        generateCertificateCard.classList.add('disabled');
                        generateCertificateCard.setAttribute('aria-disabled', 'true');
                        generateCertificateCard.style.cursor = 'not-allowed';
                        certificateProgressText.textContent = `Complete ${totalModules - completedModules} m√≥dulos restantes para gerar seu certificado.`;
                    }
                }
                renderPlaybookIndex();
            }

            function showCertificate() {
                const userData = localStorageManager('trilhaUserData');
                if (!userData) {
                    console.error("Dados do usu√°rio n√£o encontrados para gerar o certificado.");
                    userInfoModal.classList.add('show');
                    return;
                }

                certFullNameSpan.textContent = userData.fullName || 'Nome do Usu√°rio';
                certPositionSpan.textContent = userData.position || 'Cargo n√£o especificado';

                const today = new Date();
                const options = { day: '2-digit', month: 'long', year: 'numeric' };
                certIssueDateSpan.textContent = today.toLocaleDateString('pt-BR', options);

                certificateModal.classList.add('show');
            }


            // --- Inicializa√ß√£o da Capa e √çndice ---
            // Certifique-se de que a capa seja a primeira a ser mostrada
            // A fun√ß√£o showSection do navigation-manager cuidar√° de ocultar as outras.
            showSection('capa-section');
        });
    </script>
</body>
</html>